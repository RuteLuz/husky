<?xml version="1.0"?>
<!-- 
Launch all necessary components to get interaction between husky and MEROP OCU 
-->
<launch>

  <arg name="joy_dev" default="/dev/input/js0" />
  <!-- when using local pc to teleoperate -> local_teleop=true (when not necessary -> local_teleop=false) -->
  <arg name="local_teleop" default="true" />
  

  <!-- ********************** -->
  <!-- GAZEBO AND ROBOT SPAWN -->
  <!-- ********************** -->
  <include file="$(find husky_gazebo)/launch/husky_rubble_world.launch"/>


  <!-- ********************************************** -->
  <!-- ROBOT GAMEPAD TELEOP ON LOCAL PC (for testing) -->
  <!-- ********************************************** -->
  <group ns="joy_teleop">

    <group if="$(arg local_teleop)">
      <node pkg="joy" type="joy_node" name="joy_node">
        <param name="joy_node/dev" value="$(arg joy_dev)" />
      </node>
    </group>

    <rosparam command="load" file="$(find husky_control)/config/teleop.yaml" />

    <node pkg="teleop_twist_joy" type="teleop_node" name="teleop_twist_joy">
       <param name="joy_node/dev" value="$(arg joy_dev)" />
    </node>
  </group>

  <!-- ************************************************************************ -->
  <!-- ROBOT JOYSTICK TELEOP ON REMOTE PC (unity OCU - teleoperation interface) -->
  <!-- ************************************************************************ -->

  <group ns="interface_ocu">

    <rosparam command="load" file="$(find husky_control)/config/teleop_ocu.yaml" />

    <node pkg="teleop_twist_joy" type="teleop_node" name="teleop_twist_joy">
       <param name="joy_node/dev" value="$(arg joy_dev)" />
    </node>
  </group>


  <!-- ************************************** -->
  <!-- Get compressed transform image for OCU -->
  <!-- ************************************** -->
  <node pkg="image_transport" type="republish" name="image_transport_republisher" output="screen" args="raw in:=/camera/rgb/image_raw out:=/raposang/usb_cam/image_raw"/>


  <!-- ***************************************** -->
  <!-- WebSocket Comunication with Interface/OCU -->
  <!-- ***************************************** -->
  <include file="$(find husky_gazebo)/launch/husky_rosbridge.launch"/>

</launch>